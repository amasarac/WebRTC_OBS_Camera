<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebRTC Stream to OBS</title>
  </head>
  <body>
    <video id="local-video" autoplay></video>
    <script>
      const socket = new WebSocket('wss://[2605:a601:a555:4500:8cbe:f0ed:b553:f34]:4455');
      const password = '35HN14atfE9teSwR';
      const sceneName = 'WebRTC Scene';
      const sourceName = 'WebRTC Source';
      
      socket.onopen = () => {
        console.log('WebSocket connection established.');
        socket.send(JSON.stringify({
          "request-type": "SetPassword",
          "message-id": "SetPassword",
          "password": password
        }));
      };

      socket.onerror = error => {
        console.log(`WebSocket error: ${error}`);
      };

      socket.onmessage = event => {
        const data = JSON.parse(event.data);
        if (data.type === 'hello') {
          console.log('WebSocket connection successful.');
          socket.send(JSON.stringify({
            "request-type": "SetCurrentScene",
            "message-id": "SetCurrentScene",
            "scene-name": sceneName
          }));
          socket.send(JSON.stringify({
            "request-type": "SetSourceRender",
            "message-id": "SetSourceRender",
            "source": sourceName,
            "render": true
          }));
        }
      };

      function startLocalVideo() {
        const video = document.getElementById('local-video');
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => {
            video.srcObject = stream;
            console.log('Local video stream started.');
            socket.send(JSON.stringify({
              "request-type": "StartStreaming",
              "message-id": "StartStreaming"
            }));
          })
          .catch(error => {
            console.log(`Error starting local video stream: ${error}`);
          });
      }

      function stopLocalVideo() {
        const video = document.getElementById('local-video');
        video.srcObject = null;
        console.log('Local video stream stopped.');
        socket.send(JSON.stringify({
          "request-type": "StopStreaming",
          "message-id": "StopStreaming"
        }));
      }

      startLocalVideo();
    </script>
  </body>
</html>
